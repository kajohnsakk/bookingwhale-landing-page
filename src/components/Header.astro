---
import LanguageSwitcher from "./LanguageSwitcher.astro";
---

<header
  class="fixed top-0 left-0 right-0 bg-white/98 backdrop-blur-md shadow-sm z-50 border-b border-gray-100"
>
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 lg:py-5">
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <a href="/" class="flex items-center space-x-2">
          <!-- logo svg from /favicon.svg -->
          <img src="/logo.png" alt="BookingWhale - Advanced Booking Platform for Businesses" class="w-20 h-8 sm:w-24 sm:h-10 md:w-28 md:h-12" />
        </a>
        <!-- <span class="text-2xl font-bold text-gray-900">BookingWhale</span> -->
      </div>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-8">
        <a
          href="#services"
          data-translate="services"
          class="text-gray-700 hover:text-blue-600 transition-all duration-200 font-medium relative group"
        >
          Services
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all duration-200 group-hover:w-full"></span>
        </a>
        <a
          href="#features"
          data-translate="features"
          class="text-gray-700 hover:text-blue-600 transition-all duration-200 font-medium relative group"
        >
          Features
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all duration-200 group-hover:w-full"></span>
        </a>
        <a
          href="#contact"
          data-translate="contact"
          class="text-gray-700 hover:text-blue-600 transition-all duration-200 font-medium relative group"
        >
          Contact
          <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all duration-200 group-hover:w-full"></span>
        </a>
        <LanguageSwitcher />
        <button
          onclick="openBookingModal()"
          data-translate="bookNow"
          class="btn btn-primary"
        >
          Book Now
        </button>
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center space-x-3">
        <LanguageSwitcher />
        <button
          id="mobileMenuToggle"
          class="p-2 text-gray-600 hover:text-gray-900 transition-colors relative w-8 h-8 flex flex-col justify-center items-center"
          aria-label="Toggle menu"
        >
          <span
            class="hamburger-line block w-5 h-0.5 bg-current transition-all duration-300 ease-out"
          ></span>
          <span
            class="hamburger-line block w-5 h-0.5 bg-current transition-all duration-300 ease-out mt-1"
          ></span>
          <span
            class="hamburger-line block w-5 h-0.5 bg-current transition-all duration-300 ease-out mt-1"
          ></span>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobileMenu"
      class="md:hidden overflow-hidden transition-all duration-300 ease-out max-h-0 opacity-0"
    >
      <div class="pt-4 pb-6 border-t border-gray-100 mt-4">
        <div class="flex flex-col space-y-4">
          <a
            href="#services"
            data-translate="services"
            class="mobile-menu-link text-gray-700 hover:text-blue-600 transition-colors font-medium py-3 px-4 rounded-xl hover:bg-blue-50"
            onclick="closeMobileMenu()"
          >
            Services
          </a>
          <a
            href="#features"
            data-translate="features"
            class="mobile-menu-link text-gray-700 hover:text-blue-600 transition-colors font-medium py-3 px-4 rounded-xl hover:bg-blue-50"
            onclick="closeMobileMenu()"
          >
            Features
          </a>
          <a
            href="#contact"
            data-translate="contact"
            class="mobile-menu-link text-gray-700 hover:text-blue-600 transition-colors font-medium py-3 px-4 rounded-xl hover:bg-blue-50"
            onclick="closeMobileMenu()"
          >
            Contact
          </a>
          <button
            onclick="openBookingModal(); closeMobileMenu();"
            data-translate="bookNow"
            class="btn btn-primary w-full mt-4"
          >
            Book Now
          </button>
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  let isMobileMenuOpen = false;

  function toggleMobileMenu() {
    const mobileMenu = document.getElementById("mobileMenu");
    const mobileMenuToggle = document.getElementById("mobileMenuToggle");
    const hamburgerLines =
      mobileMenuToggle?.querySelectorAll(".hamburger-line");

    isMobileMenuOpen = !isMobileMenuOpen;

    if (isMobileMenuOpen) {
      // Open menu
      mobileMenu?.classList.remove("max-h-0", "opacity-0");
      mobileMenu?.classList.add("max-h-96", "opacity-100");

      // Animate hamburger to X
      if (hamburgerLines) {
        hamburgerLines[0].style.transform = "rotate(45deg) translate(5px, 5px)";
        hamburgerLines[1].style.opacity = "0";
        hamburgerLines[2].style.transform =
          "rotate(-45deg) translate(7px, -6px)";
      }
    } else {
      // Close menu
      mobileMenu?.classList.add("max-h-0", "opacity-0");
      mobileMenu?.classList.remove("max-h-96", "opacity-100");

      // Reset hamburger
      if (hamburgerLines) {
        hamburgerLines[0].style.transform = "none";
        hamburgerLines[1].style.opacity = "1";
        hamburgerLines[2].style.transform = "none";
      }
    }
  }

  function closeMobileMenu() {
    if (isMobileMenuOpen) {
      toggleMobileMenu();
    }
  }

  // Event listeners
  document
    .getElementById("mobileMenuToggle")
    ?.addEventListener("click", toggleMobileMenu);

  // Close mobile menu when clicking outside
  document.addEventListener("click", (e) => {
    const header = document.querySelector("header");
    if (!header?.contains(e.target) && isMobileMenuOpen) {
      closeMobileMenu();
    }
  });

  // Close mobile menu on window resize to desktop
  window.addEventListener("resize", () => {
    if (window.innerWidth >= 768 && isMobileMenuOpen) {
      closeMobileMenu();
    }
  });

  // Smooth scrolling for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) {
        const headerHeight = 80;
        const targetPosition = target.offsetTop - headerHeight;

        window.scrollTo({
          top: targetPosition,
          behavior: "smooth",
        });
      }
    });
  });

  // Header background on scroll
  window.addEventListener("scroll", () => {
    const header = document.querySelector("header");
    if (window.scrollY > 100) {
      header?.classList.add("bg-white/95");
      header?.classList.remove("bg-white/98");
    } else {
      header?.classList.add("bg-white/98");
      header?.classList.remove("bg-white/95");
    }
  });

  // Make functions globally available
  window.toggleMobileMenu = toggleMobileMenu;
  window.closeMobileMenu = closeMobileMenu;
</script>

<style>
  .hamburger-line {
    transform-origin: center;
  }

  #mobileMenu {
    transition:
      max-height 0.3s ease-out,
      opacity 0.3s ease-out;
  }

  .mobile-menu-link {
    transition: all 0.2s ease;
  }

  @media (max-width: 768px) {
    .language-switcher {
      position: static;
    }

    .language-switcher #languageDropdown {
      right: 0;
      left: auto;
    }
  }
</style>
